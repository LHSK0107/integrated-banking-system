<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lhsk.iam.domain.dashboard.model.mapper.DashboardMapper">
	<select id="findByAdminsAcctDvToBalSum" resultType="AcctDvByBalSumVO">
		SELECT acct_dv, SUM(bal) AS balSum 
		FROM account 
		GROUP BY acct_dv
		HAVING acct_dv != '04'
		ORDER BY acct_dv ASC
	</select>
	
	<select id="findByAdminsAllAccountToBalSum" resultType="BigDecimal">
		SELECT SUM(
			CASE 
				WHEN acct_dv = '03' 
				THEN -bal
				ELSE bal
		    END
		) AS ALL_ACCT_SUM
		FROM account
		WHERE acct_dv IN ('01', '02', '03')
	</select>
	
	<select id="findByUsersAcctDvToBalSum" parameterType="int" resultType="AcctDvByBalSumVO">
		SELECT acct_dv, SUM(bal) AS balSum
		FROM account ACCT
			INNER JOIN user_account UA
				ON UA.acct_no = ACCT.acct_no
		WHERE user_no = #{userNo}
		GROUP BY acct_dv 
		HAVING acct_dv != '04'
		ORDER BY acct_dv ASC		
	</select>
	
	<select id="findByUsersAllAccountToBalSum" parameterType="int" resultType="BigDecimal">
		SELECT SUM(
			CASE 
				WHEN acct_dv = '03'
				THEN -bal
		        ELSE bal
			END
		) AS ALL_ACCT_SUM
		FROM account ACCT
			INNER JOIN user_account UA
				ON UA.acct_no = ACCT.acct_no
		WHERE user_no = #{userNO} 
			AND acct_dv IN ('01', '02', '03')
	</select>

	<select id="AdminsAcctDv01InoutSum" parameterType="java.time.LocalDate" resultType="AcctDv01InoutSumVo">
		SELECT inout_dv, trsc_dt, SUM(trsc_amt) AS amtSum
		FROM inout_past IOP
			INNER JOIN account ACCT
				ON IOP.acct_no = ACCT.acct_no
		WHERE (trsc_dt BETWEEN #{startDt} AND DATE_FORMAT(CURDATE()-1, '%Y-%m-%d'))
		GROUP BY trsc_dt, acct_dv, inout_dv
		HAVING acct_dv = '01'
		UNION
		SELECT inout_dv, trsc_dt, SUM(trsc_amt) AS amtSum
		FROM inout_today IOT
			INNER JOIN account ACCT
				ON IOT.acct_no = ACCT.acct_no
		GROUP BY trsc_dt, acct_dv, inout_dv
		HAVING acct_dv = '01'
		ORDER BY trsc_dt DESC, inout_dv ASC
	</select>
	
	<select id="UsersAcctDv01InoutSum" parameterType="Map" resultType="AcctDv01InoutSumVo">
	
	</select>
	
</mapper>